<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pencatatan Keuangan</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for confirmation modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 400px;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center py-8">

    <div class="w-full max-w-4xl bg-white shadow-lg rounded-lg p-6 md:p-8">
        <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-6">
            Aplikasi Pencatatan Keuangan
        </h1>

        <p class="text-sm text-gray-600 text-center mb-4">
            Data disimpan secara lokal di browser Anda.
        </p>

        <!-- Message Display -->
        <div id="message-display" class="hidden bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative mb-4" role="alert">
            <span id="message-text" class="block sm:inline"></span>
        </div>

        <!-- Financial Summary -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="bg-green-500 text-white p-4 rounded-lg shadow-md flex flex-col items-center justify-center">
                <p class="text-sm font-semibold">Total Pemasukan</p>
                <p id="total-income" class="text-2xl font-bold">Rp0</p>
            </div>
            <div class="bg-red-500 text-white p-4 rounded-lg shadow-md flex flex-col items-center justify-center">
                <p class="text-sm font-semibold">Total Pengeluaran</p>
                <p id="total-expense" class="text-2xl font-bold">Rp0</p>
            </div>
            <div id="balance-card" class="p-4 rounded-lg shadow-md flex flex-col items-center justify-center bg-blue-500 text-white">
                <p class="text-sm font-semibold">Saldo</p>
                <p id="balance" class="text-2xl font-bold">Rp0</p>
            </div>
        </div>

        <!-- Transaction Form -->
        <form id="transaction-form" class="bg-gray-50 p-6 rounded-lg shadow-inner mb-8">
            <h2 id="form-title" class="text-2xl font-semibold text-gray-700 mb-4">Tambah Transaksi Baru</h2>
            <div class="mb-4">
                <label for="description" class="block text-gray-700 text-sm font-bold mb-2">
                    Deskripsi:
                </label>
                <input
                    type="text"
                    id="description"
                    class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    placeholder="Contoh: Gaji bulanan, Belanja makanan"
                    required
                />
            </div>
            <div class="mb-4">
                <label for="amount" class="block text-gray-700 text-sm font-bold mb-2">
                    Jumlah (Rp):
                </label>
                <input
                    type="number"
                    id="amount"
                    class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    placeholder="Contoh: 500000"
                    min="0"
                    step="0.01"
                    required
                />
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2">
                    Jenis Transaksi:
                </label>
                <div class="flex space-x-4">
                    <label class="inline-flex items-center">
                        <input
                            type="radio"
                            class="form-radio text-green-600"
                            name="type"
                            value="income"
                            checked
                        />
                        <span class="ml-2 text-gray-700">Pemasukan</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input
                            type="radio"
                            class="form-radio text-red-600"
                            name="type"
                            value="expense"
                        />
                        <span class="ml-2 text-gray-700">Pengeluaran</span>
                    </label>
                </div>
            </div>
            <div class="flex items-center justify-between">
                <button
                    type="submit"
                    id="submit-button"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:shadow-outline transition duration-200 ease-in-out transform hover:scale-105"
                >
                    Tambah Transaksi
                </button>
                <button
                    type="button"
                    id="cancel-edit-button"
                    class="hidden bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:shadow-outline transition duration-200 ease-in-out transform hover:scale-105"
                >
                    Batal Edit
                </button>
            </div>
        </form>

        <!-- Transaction List -->
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">Riwayat Transaksi</h2>
        <div id="transactions-list" class="space-y-4">
            <p id="no-transactions-message" class="text-gray-600 text-center">Belum ada transaksi. Tambahkan yang pertama!</p>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmation-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <p class="text-lg mb-4">Apakah Anda yakin ingin menghapus transaksi ini?</p>
            <div class="flex justify-end space-x-4">
                <button id="confirm-delete-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg">Ya, Hapus</button>
                <button id="cancel-delete-btn" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">Batal</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const transactionForm = document.getElementById('transaction-form');
        const descriptionInput = document.getElementById('description');
        const amountInput = document.getElementById('amount');
        const typeInputs = document.querySelectorAll('input[name="type"]');
        const submitButton = document.getElementById('submit-button');
        const cancelEditButton = document.getElementById('cancel-edit-button');
        const totalIncomeDisplay = document.getElementById('total-income');
        const totalExpenseDisplay = document.getElementById('total-expense');
        const balanceDisplay = document.getElementById('balance');
        const balanceCard = document.getElementById('balance-card');
        const transactionsList = document.getElementById('transactions-list');
        const noTransactionsMessage = document.getElementById('no-transactions-message');
        const messageDisplay = document.getElementById('message-display');
        const messageText = document.getElementById('message-text');
        const formTitle = document.getElementById('form-title');

        // Modal Elements
        const confirmationModal = document.getElementById('confirmation-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');

        let transactions = [];
        let editingTransaction = null;
        let transactionToDeleteId = null; // To store the ID of the transaction to be deleted

        // Function to display messages
        function showMessage(msg, type = 'info') {
            messageText.textContent = msg;
            messageDisplay.classList.remove('hidden', 'bg-blue-100', 'bg-green-100', 'bg-red-100');
            messageDisplay.classList.remove('border-blue-400', 'border-green-400', 'border-red-400');
            messageDisplay.classList.remove('text-blue-700', 'text-green-700', 'text-red-700');

            if (type === 'info') {
                messageDisplay.classList.add('bg-blue-100', 'border-blue-400', 'text-blue-700');
            } else if (type === 'success') {
                messageDisplay.classList.add('bg-green-100', 'border-green-400', 'text-green-700');
            } else if (type === 'error') {
                messageDisplay.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
            }

            setTimeout(() => {
                messageDisplay.classList.add('hidden');
            }, 3000);
        }

        // Function to load transactions from localStorage
        function loadTransactions() {
            try {
                const storedTransactions = localStorage.getItem('financeTransactions');
                if (storedTransactions) {
                    transactions = JSON.parse(storedTransactions);
                    // Sort by timestamp in descending order
                    transactions.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                }
            } catch (error) {
                console.error("Error loading transactions from localStorage:", error);
                showMessage("Gagal memuat transaksi dari penyimpanan lokal.", 'error');
            }
        }

        // Function to save transactions to localStorage
        function saveTransactions() {
            try {
                localStorage.setItem('financeTransactions', JSON.stringify(transactions));
            } catch (error) {
                console.error("Error saving transactions to localStorage:", error);
                showMessage("Gagal menyimpan transaksi ke penyimpanan lokal.", 'error');
            }
        }

        // Function to render transactions and update summary
        function renderTransactions() {
            transactionsList.innerHTML = ''; // Clear existing list
            if (transactions.length === 0) {
                noTransactionsMessage.classList.remove('hidden');
            } else {
                noTransactionsMessage.classList.add('hidden');
                transactions.forEach(transaction => {
                    const transactionElement = document.createElement('div');
                    transactionElement.className = `flex justify-between items-center p-4 rounded-lg shadow-md ${
                        transaction.type === 'income' ? 'bg-green-100 border-l-4 border-green-500' : 'bg-red-100 border-l-4 border-red-500'
                    }`;
                    const date = new Date(transaction.timestamp);
                    const formattedDate = date.toLocaleDateString('id-ID', {
                        year: 'numeric', month: 'long', day: 'numeric'
                    });

                    transactionElement.innerHTML = `
                        <div>
                            <p class="text-lg font-medium text-gray-800">${transaction.description}</p>
                            <p class="text-sm text-gray-600">${formattedDate}</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <p class="text-lg font-bold ${transaction.type === 'income' ? 'text-green-700' : 'text-red-700'}">
                                ${transaction.type === 'income' ? '+' : '-'}Rp${transaction.amount.toLocaleString('id-ID')}
                            </p>
                            <button data-id="${transaction.id}" class="edit-btn bg-yellow-500 hover:bg-yellow-600 text-white p-2 rounded-full shadow-sm transition duration-200 ease-in-out transform hover:scale-110" title="Edit Transaksi">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zm-3.646 3.646l-2.828 2.828-1.414-1.414L8.586 6.757 10 5.343 13.586 8.93l-3.646 3.647zM15 12l-3 3v2h2l3-3V12z" />
                                </svg>
                            </button>
                            <button data-id="${transaction.id}" class="delete-btn bg-red-500 hover:bg-red-600 text-white p-2 rounded-full shadow-sm transition duration-200 ease-in-out transform hover:scale-110" title="Hapus Transaksi">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    `;
                    transactionsList.appendChild(transactionElement);
                });

                // Attach event listeners to new buttons
                document.querySelectorAll('.edit-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        const transactionToEdit = transactions.find(t => t.id === id);
                        if (transactionToEdit) {
                            editTransaction(transactionToEdit);
                        }
                    });
                });

                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        showDeleteConfirmation(id);
                    });
                });
            }

            // Calculate and update summary
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((acc, t) => acc + t.amount, 0);

            const totalExpense = transactions
                .filter(t => t.type === 'expense')
                .reduce((acc, t) => acc + t.amount, 0);

            const balance = totalIncome - totalExpense;

            totalIncomeDisplay.textContent = `Rp${totalIncome.toLocaleString('id-ID')}`;
            totalExpenseDisplay.textContent = `Rp${totalExpense.toLocaleString('id-ID')}`;
            balanceDisplay.textContent = `Rp${balance.toLocaleString('id-ID')}`;

            if (balance >= 0) {
                balanceCard.classList.remove('bg-gray-700');
                balanceCard.classList.add('bg-blue-500');
            } else {
                balanceCard.classList.remove('bg-blue-500');
                balanceCard.classList.add('bg-gray-700');
            }
        }

        // Function to handle adding/updating a transaction
        function handleAddOrUpdateTransaction(e) {
            e.preventDefault();

            const description = descriptionInput.value.trim();
            const amount = parseFloat(amountInput.value);
            const type = document.querySelector('input[name="type"]:checked').value;

            if (!description || isNaN(amount) || amount <= 0) {
                showMessage("Mohon isi deskripsi dan jumlah yang valid.", 'error');
                return;
            }

            const newTransactionData = {
                description: description,
                amount: amount,
                type: type,
                timestamp: Date.now(),
            };

            if (editingTransaction) {
                // Update existing transaction
                transactions = transactions.map(t =>
                    t.id === editingTransaction.id ? { ...newTransactionData, id: t.id } : t
                );
                showMessage("Transaksi berhasil diperbarui!", 'success');
                editingTransaction = null;
                submitButton.textContent = 'Tambah Transaksi';
                formTitle.textContent = 'Tambah Transaksi Baru';
                cancelEditButton.classList.add('hidden');
            } else {
                // Add new transaction
                newTransactionData.id = Date.now().toString() + Math.random().toString(36).substring(2, 9);
                transactions.unshift(newTransactionData); // Add to the beginning for latest first
                showMessage("Transaksi berhasil ditambahkan!", 'success');
            }

            saveTransactions();
            renderTransactions();
            transactionForm.reset(); // Clear form
            descriptionInput.focus(); // Focus on description for next entry
        }

        // Function to trigger edit mode
        function editTransaction(transaction) {
            editingTransaction = transaction;
            descriptionInput.value = transaction.description;
            amountInput.value = transaction.amount;
            document.querySelector(`input[name="type"][value="${transaction.type}"]`).checked = true;

            submitButton.textContent = 'Perbarui Transaksi';
            formTitle.textContent = 'Edit Transaksi';
            cancelEditButton.classList.remove('hidden');
            descriptionInput.focus();
        }

        // Function to cancel edit mode
        function cancelEdit() {
            editingTransaction = null;
            transactionForm.reset();
            submitButton.textContent = 'Tambah Transaksi';
            formTitle.textContent = 'Tambah Transaksi Baru';
            cancelEditButton.classList.add('hidden');
            descriptionInput.focus();
        }

        // Function to show delete confirmation modal
        function showDeleteConfirmation(id) {
            transactionToDeleteId = id;
            confirmationModal.classList.remove('hidden');
        }

        // Function to hide delete confirmation modal
        function hideDeleteConfirmation() {
            transactionToDeleteId = null;
            confirmationModal.classList.add('hidden');
        }

        // Function to perform actual deletion
        function confirmDelete() {
            if (transactionToDeleteId) {
                transactions = transactions.filter(t => t.id !== transactionToDeleteId);
                saveTransactions();
                renderTransactions();
                showMessage("Transaksi berhasil dihapus!", 'success');
            }
            hideDeleteConfirmation();
        }

        // Event Listeners
        window.onload = () => {
            loadTransactions();
            renderTransactions();
        };

        transactionForm.addEventListener('submit', handleAddOrUpdateTransaction);
        cancelEditButton.addEventListener('click', cancelEdit);

        // Modal event listeners
        confirmDeleteBtn.addEventListener('click', confirmDelete);
        cancelDeleteBtn.addEventListener('click', hideDeleteConfirmation);

    </script>
</body>
</html>
